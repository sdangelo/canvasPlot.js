<html>
<head>
  <title>canvasPlot.js example</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <script src="canvasPlot.js" type="text/javascript"></script>
  <script src="mapLinear.js" type="text/javascript"></script>
  <script src="curveDrawerLinear.js" type="text/javascript"></script>
  <script src="circularBuffer.js" type="text/javascript"></script>
  <script src="curveCircular.js" type="text/javascript"></script>
  <script src="simplePlot.js" type="text/javascript"></script>
  <script type="text/javascript">
function init() {
	var canvas = document.getElementById("canvas");
	var form = document.getElementById("form");

	var style = window.getComputedStyle(canvas);
	var leaveWidth = parseFloat(style.getPropertyValue("margin-left"))
			 + parseFloat(style.getPropertyValue("margin-right"));
	var leaveHeight = parseFloat(style.getPropertyValue("margin-top"))
			  + parseFloat(style.getPropertyValue("margin-bottom"));
	style = window.getComputedStyle(form);
	leaveHeight += parseFloat(style.getPropertyValue("margin-bottom"));
	var oldWidth = 0;
	var oldHeight = 0;

	var p = Object.create(canvasPlot.simplePlot);
	p.init(Object.create(canvasPlot.mapLinear), null, null, null);

	p.frame.area.p.x = 0;
	p.frame.area.p.y = 0;

	var drawer = Object.create(canvasPlot.curveDrawerLinear);

	var ctx = canvas.getContext("2d");

	var cfirst = 2;
	function draw() {
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		if (p.grid)
			p.grid.draw(ctx, p.frame.innerArea);
		if (p.curves && p.curves[0])
			p.curves[0].drawPart(ctx, p.frame.innerArea, drawer,
				cfirst, (cfirst + p.curves[0].samples.x.length
					 - 1) % p.curves[0].samples.x.length);
		p.frame.draw(ctx);
	}

	function resize() {
		var r = canvas.parentNode.getBoundingClientRect();
		if (r.width == oldWidth && r.height == oldHeight)
			return;
		oldWidth = r.width;
		oldHeight = r.height;

		var xHeight = leaveHeight
			      + parseFloat(style.getPropertyValue("height"));

		canvas.width = r.width - leaveWidth;
		canvas.height = r.height - xHeight;

		canvas.width = canvas.parentNode.scrollWidth - leaveWidth;
		canvas.height = canvas.parentNode.scrollHeight - xHeight;

		p.frame.area.width = canvas.width;
		p.frame.area.height = canvas.height;

		p.update(true, true);

		draw();
	}
	resize();
	window.addEventListener("resize", resize);

	var xrange_min_elem = document.getElementById("xrange_min");
	var xrange_max_elem = document.getElementById("xrange_max");
	var yrange_min_elem = document.getElementById("yrange_min");
	var yrange_max_elem = document.getElementById("yrange_max");
	var xtics_elem = document.getElementById("xtics");
	var ytics_elem = document.getElementById("ytics");
	var x_elem = document.getElementById("x");
	var y_elem = document.getElementById("y");
	var coff_elem = document.getElementById("coff");
	var cstep_elem = document.getElementById("cstep");
	var cfirst_elem = document.getElementById("cfirst");
	function plot() {
		var xrange_min = parseFloat(xrange_min_elem.value);
		if (!isFinite(xrange_min)) {
			alert("Invalid x range minimum value!");
			return;
		}

		var xrange_max = parseFloat(xrange_max_elem.value);
		if (!isFinite(xrange_max)) {
			alert("Invalid x range maximum value!");
			return;
		}
		if (xrange_max < xrange_min) {
			alert("x range maximum must be bigger than minimum!");
			return;
		}

		var yrange_min = parseFloat(yrange_min_elem.value);
		if (!isFinite(yrange_min)) {
			alert("Invalid y range minimum value!");
			return;
		}

		var yrange_max = parseFloat(yrange_max_elem.value);
		if (!isFinite(yrange_max)) {
			alert("Invalid y range maximum value!");
			return;
		}
		if (yrange_max < yrange_min) {
			alert("y range maximum must be bigger than minimum!");
			return;
		}

		var xtics = parseFloat(xtics_elem.value);
		if (!isFinite(xtics)) {
			alert("Invalid x grid tics spacing value!");
			return;
		}
		if (xtics <= 0.0) {
			alert("x grid tics spacing must be a strictly positive "
			      + "value!");
			return;
		}

		var ytics = parseFloat(ytics_elem.value);
		if (!isFinite(ytics)) {
			alert("Invalid y grid tics spacing value!");
			return;
		}
		if (ytics <= 0.0) {
			alert("y grid tics spacing must be a strictly positive "
			      + "value!");
			return;
		}

		var re = /\s+/;
		var x = x_elem.value.trim().split(re);
		var y = y_elem.value.trim().split(re);

		if (x.length != y.length) {
			alert("Numbers of x and y coordinates do no match!");
			return;
		}

		for (var i = 0; i < x.length; i++) {
			x[i] = parseFloat(x[i]);
			y[i] = parseFloat(y[i]);
		}

		var coff = parseInt(coff_elem.value);
		if (!isFinite(coff)) {
			alert("Invalid circular buffer offset value!");
			return;
		}
		if (coff < 0 || coff >= x.length) {
			alert("circular buffer offset is outside of bounds (0 "
			      + "to " + (x.length - 1) + ")!");
			return;
		}

		var cstep = parseInt(cstep_elem.value);
		if (!isFinite(cstep)) {
			alert("Invalid circular buffer step value!");
			return;
		}
		if (cstep < 1 || cstep > x.length) {
			alert("circular buffer step is outside of bounds (1 "
			      + " to " + x.length + ")!");
			return;
		}

		var xcfirst = parseInt(cfirst_elem.value);
		if (!isFinite(cfirst)) {
			alert("Invalid circular drawing first sample value!");
			return;
		}
		if (xcfirst < 0 || (x.length != 0 && xcfirst >= x.length)) {
			alert("circular drawing first sample is outside of "
			      + "bounds (0 to " + (x.length - 1) + ")!");
			return;
		}

		p.map.xRange.min = xrange_min;
		p.map.xRange.max = xrange_max;
		p.map.yRange.min = yrange_min;
		p.map.yRange.max = yrange_max;

		var xtic = Object.create(canvasPlot.tic);
		xtic.direction = canvasPlot.direction.vertical;
		var ytic = Object.create(canvasPlot.tic);
		ytic.direction = canvasPlot.direction.horizontal;

		var i, v;
		for (i = 0, v = xrange_min + xtics; v < xrange_max;
		     i++, v += xtics) {
			p.grid.tics[i] = Object.create(xtic);
			p.grid.tics[i].init();
			p.grid.tics[i].value = v;
		}
		for (v = yrange_min + ytics; v < yrange_max;
		     i++, v += ytics) {
			p.grid.tics[i] = Object.create(ytic);
			p.grid.tics[i].init();
			p.grid.tics[i].value = v;
		}

		var samples = Object.create(canvasPlot.samples);

		if (x.length == 0)
			samples.init(x, y);
		else {
			coff %= x.length;
			if (cstep > x.length)
				cstep = x.length;

			var cx = Object.create(canvasPlot.circularBuffer);
			var cy = Object.create(canvasPlot.circularBuffer);
			cx.init(Array(x.length));
			cy.init(Array(y.length));

			if (coff != 0) {
				var fill = Array(coff);
				for (var i = 0; i < coff; i++)
					fill[i] = NaN;

				cx.write(fill, 0, coff);
				cy.write(fill, 0, coff);
			}

			for (var i = coff, left = x.length; left >= cstep;
			     left -= cstep) {
				cx.write(x, i, cstep);
				cy.write(y, i, cstep);
				i += cstep;
				if (i >= x.length)
					i -= x.length;
			}
			if (left != 0) {
				cx.write(x, i, left);
				cy.write(y, i, left);
			}

			samples.init(cx.buffer, cy.buffer);
		}

		p.curves = [];
		p.curves[0] = Object.create(canvasPlot.curveCircular);
		p.curves[0].init(samples, null);

		cfirst = xcfirst;

		p.update(false, true);

		draw();
	}
	var plotButton = document.getElementById("plot");
	plotButton.addEventListener("click", plot);
}

window.addEventListener("load", init);
  </script>
</head>
<body>
  <canvas id="canvas"></canvas>
  <form id="form">
    <div>
      <span>x axis range</span>
      <label for="xrange_min">min: </label>
      <input type="text" id="xrange_min" value="0.0" />
      <label for="xrange_max">max: </label>
      <input type="text" id="xrange_max" value="1.0" />
    </div>
    <div>
      <span>y axis range</span>
      <label for="yrange_min">min: </label>
      <input type="text" id="yrange_min" value="0.0" />
      <label for="yrange_max">max: </label>
      <input type="text" id="yrange_max" value="1.0" />
    </div>
    <div>
      <span>grid tics spacing</span>
      <label for="xtics">x: </label>
      <input type="text" id="xtics" value="0.1" />
      <label for="ytics">y: </label>
      <input type="text" id="ytics" value="0.1" />
    </div>
    <div>
      <span>coordinates</span>
      <label for="x">x: </label>
      <input type="text" id="x" value="0.0 0.5 1.0" />
      <label for="y">y: </label>
      <input type="text" id="y" value="0.0 1.0 0.0" />
    </div>
    <div>
      <span>circ. draw</span>
      <label for="cfirst">first: </label>
      <input type="text" id="cfirst" value="0" />
    </div>
    <div>
      <span>circ. buf.</span>
      <label for="coff">offset: </label>
      <input type="text" id="coff" value="0" />
      <label for="cstep">step: </label>
      <input type="text" id="cstep" value="1" />
    </div>
    <div>
      <input type="button" id="plot" value="Plot" />
    </div>
  </form>
</html>
